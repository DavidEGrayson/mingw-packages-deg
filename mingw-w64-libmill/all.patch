diff -u -r libmill-1.2-orig/chan.c libmill-1.2/chan.c
--- libmill-1.2-orig/chan.c	2015-12-05 11:46:22.903992700 -0800
+++ libmill-1.2/chan.c	2015-12-05 11:55:45.854438900 -0800
@@ -258,7 +258,7 @@
     /* If there are clauses that are immediately available
        randomly choose one of them. */
     if(uc->available > 0) {
-        int chosen = uc->available == 1 ? 0 : (int)(random() % (uc->available));
+        int chosen = uc->available == 1 ? 0 : (int)(rand() % (uc->available));
         for(it = mill_slist_begin(&uc->clauses); it; it = mill_slist_next(it)) {
             cl = mill_cont(it, struct mill_clause, chitem);
             if(!cl->available)
@@ -288,7 +288,7 @@
         cl = mill_cont(it, struct mill_clause, chitem);
         if(mill_slow(cl->ep->refs > 1)) {
             if(cl->ep->tmp == -1)
-                cl->ep->tmp = cl->ep->refs == 1 ? 0 : (int)(random() % cl->ep->refs);
+                cl->ep->tmp = cl->ep->refs == 1 ? 0 : (int)(rand() % cl->ep->refs);
             if(cl->ep->tmp) {
                 --cl->ep->tmp;
                 cl->used = 0;
diff -u -r libmill-1.2-orig/debug.c libmill-1.2/debug.c
--- libmill-1.2-orig/debug.c	2015-12-05 11:46:23.013370400 -0800
+++ libmill-1.2/debug.c	2015-12-05 12:09:21.295305600 -0800
@@ -205,7 +205,8 @@
     /* First print the timestamp. */
     struct timeval nw;
     gettimeofday(&nw, NULL);
-    struct tm *nwtm = localtime(&nw.tv_sec);
+    time_t tv_sec = nw.tv_sec;
+    struct tm *nwtm = localtime(&tv_sec);
     snprintf(buf, sizeof buf, "%02d:%02d:%02d",
         (int)nwtm->tm_hour, (int)nwtm->tm_min, (int)nwtm->tm_sec);
     fprintf(stderr, "==> %s.%06d ", buf, (int)nw.tv_usec);
diff -u -r libmill-1.2-orig/ip.c libmill-1.2/ip.c
--- libmill-1.2-orig/ip.c	2015-12-05 11:46:22.919615000 -0800
+++ libmill-1.2/ip.c	2015-12-05 12:30:42.560183500 -0800
@@ -28,13 +28,20 @@
 #include <sys/eventfd.h>
 #endif
 
+#if defined _WIN32
+#include <winsock2.h>
+#include <ws2ipdef.h>
+#include <ws2tcpip.h>
+#else
 #include <arpa/inet.h>
-#include <errno.h>
 #include <netinet/in.h>
+#include <sys/socket.h>
+#endif
+
+#include <errno.h>
 #include <string.h>
 #include <sys/types.h>
-#include <sys/socket.h>
-#if !defined __sun
+#if !defined __sun && !defined _WIN32
 #include <ifaddrs.h>
 #endif
 #include <unistd.h>
@@ -165,7 +172,7 @@
     if(!name)
         return mill_ipany(port, mode);
     ipaddr addr = mill_ipliteral(name, port, mode);
-#if defined __sun
+#if defined __sun || defined _WIN32
     return addr;
 #else
     if(errno == 0)
diff -u -r libmill-1.2-orig/poller.c libmill-1.2/poller.c
--- libmill-1.2-orig/poller.c	2015-12-05 11:46:22.935242900 -0800
+++ libmill-1.2/poller.c	2015-12-05 12:36:09.494170000 -0800
@@ -162,7 +162,8 @@
 #include "epoll.inc"
 #elif defined BSD
 #include "kqueue.inc"
+#elif defined _WIN32
+// TODO: polling for Windows
 #else
 #include "poll.inc"
 #endif
-
diff -u -r libmill-1.2-orig/stack.c libmill-1.2/stack.c
--- libmill-1.2-orig/stack.c	2015-12-05 11:46:23.013370400 -0800
+++ libmill-1.2/stack.c	2015-12-05 12:45:07.387412400 -0800
@@ -27,7 +27,12 @@
 #include <stdlib.h>
 #include <errno.h>
 #include <unistd.h>
+
+#if defined _WIN32
+#include <windows.h>
+#else
 #include <sys/mman.h>
+#endif
 
 #include "slist.h"
 #include "stack.h"
@@ -38,7 +43,13 @@
     static long pgsz = 0;
     if(mill_fast(pgsz))
         return (size_t)pgsz;
+    #if defined _WIN32
+    SYSTEM_INFO si;
+    GetSystemInfo(&si);
+    pgsz = si.dwPageSize;
+    #else
     pgsz = sysconf(_SC_PAGE_SIZE);
+    #endif
     mill_assert(pgsz > 0);
     return (size_t)pgsz;
 }
diff -u -r libmill-1.2-orig/tcp.c libmill-1.2/tcp.c
--- libmill-1.2-orig/tcp.c	2015-12-05 11:46:22.935242900 -0800
+++ libmill-1.2/tcp.c	2015-12-05 12:47:56.044621000 -0800
@@ -22,15 +22,22 @@
 
 */
 
+#if defined _WIN32
+#include <winsock2.h>
+#include <ws2ipdef.h>
+#include <ws2tcpip.h>
+#else
 #include <arpa/inet.h>
+#include <netinet/in.h>
+#include <sys/socket.h>
+#endif
+
 #include <errno.h>
 #include <fcntl.h>
-#include <netinet/in.h>
 #include <stddef.h>
 #include <stdlib.h>
 #include <string.h>
 #include <sys/types.h>
-#include <sys/socket.h>
 #include <unistd.h>
 
 #include "ip.h"
diff -u -r libmill-1.2-orig/utils.h libmill-1.2/utils.h
--- libmill-1.2-orig/utils.h	2015-12-05 11:46:22.935242900 -0800
+++ libmill-1.2/utils.h	2015-12-05 11:51:20.047750400 -0800
@@ -31,13 +31,21 @@
 #include <stdio.h>
 #include <stdlib.h>
 
-/* For now use longjmp. Replace by a different mechanism as needed. */
+/* For now use longjmp or siglongjmp. Replace by a different mechanism as needed. */
+
+#ifdef _WIN32
+struct mill_ctx {
+    jmp_buf jbuf;
+};
+#define mill_setjmp(ctx) setjmp((ctx)->jbuf)
+#define mill_jmp(ctx) longjmp((ctx)->jbuf, 1)
+#else
 struct mill_ctx {
     sigjmp_buf jbuf;
 };
-
 #define mill_setjmp(ctx) sigsetjmp((ctx)->jbuf, 0)
 #define mill_jmp(ctx) siglongjmp((ctx)->jbuf, 1)
+#endif
 
 /* Cause panic. */
 void mill_panic(const char *text);
