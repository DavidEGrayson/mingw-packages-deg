diff -u -r libmill-1.2-orig/chan.c libmill-1.2/chan.c
--- libmill-1.2-orig/chan.c	2015-12-05 11:46:22.903992700 -0800
+++ libmill-1.2/chan.c	2015-12-05 11:55:45.854438900 -0800
@@ -258,7 +258,7 @@
     /* If there are clauses that are immediately available
        randomly choose one of them. */
     if(uc->available > 0) {
-        int chosen = uc->available == 1 ? 0 : (int)(random() % (uc->available));
+        int chosen = uc->available == 1 ? 0 : (int)(rand() % (uc->available));
         for(it = mill_slist_begin(&uc->clauses); it; it = mill_slist_next(it)) {
             cl = mill_cont(it, struct mill_clause, chitem);
             if(!cl->available)
@@ -288,7 +288,7 @@
         cl = mill_cont(it, struct mill_clause, chitem);
         if(mill_slow(cl->ep->refs > 1)) {
             if(cl->ep->tmp == -1)
-                cl->ep->tmp = cl->ep->refs == 1 ? 0 : (int)(random() % cl->ep->refs);
+                cl->ep->tmp = cl->ep->refs == 1 ? 0 : (int)(rand() % cl->ep->refs);
             if(cl->ep->tmp) {
                 --cl->ep->tmp;
                 cl->used = 0;
diff -u -r libmill-1.2-orig/utils.h libmill-1.2/utils.h
--- libmill-1.2-orig/utils.h	2015-12-05 11:46:22.935242900 -0800
+++ libmill-1.2/utils.h	2015-12-05 11:51:20.047750400 -0800
@@ -31,13 +31,21 @@
 #include <stdio.h>
 #include <stdlib.h>
 
-/* For now use longjmp. Replace by a different mechanism as needed. */
+/* For now use longjmp or siglongjmp. Replace by a different mechanism as needed. */
+
+#ifdef _WIN32
+struct mill_ctx {
+    jmp_buf jbuf;
+};
+#define mill_setjmp(ctx) setjmp((ctx)->jbuf)
+#define mill_jmp(ctx) longjmp((ctx)->jbuf, 1)
+#else
 struct mill_ctx {
     sigjmp_buf jbuf;
 };
-
 #define mill_setjmp(ctx) sigsetjmp((ctx)->jbuf, 0)
 #define mill_jmp(ctx) siglongjmp((ctx)->jbuf, 1)
+#endif
 
 /* Cause panic. */
 void mill_panic(const char *text);
